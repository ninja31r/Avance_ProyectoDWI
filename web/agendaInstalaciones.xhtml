<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      xmlns:pt="http://xmlns.jcp.org/jsf/passthrough"
      xmlns:ui="jakarta.faces.facelets">

<h:head>
    <title>Agenda de Instalaciones | Auditel Import S.A.C</title>
    <meta name="viewport" content="width=device-width, initial-scale=1"/>

    <!-- Bootstrap + Icons -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"/>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet"/>

    <!-- FullCalendar -->
    <link href="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.8/index.global.min.css" rel="stylesheet"/>
    <script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.8/index.global.min.js"></script>

    <style>
        body {
            background-color: #f8f9fa;
        }
        .table th {
            background-color: #198754;
            color: white;
        }
        .table-hover tbody tr:hover {
            background-color: #eaf4ee;
        }
        .badge-status {
            font-size: 0.9rem;
            padding: 6px 10px;
            border-radius: 10px;
        }
        #calendar {
            background: #fff;
            padding: 15px;
            border-radius: 12px;
            box-shadow: 0 0 15px rgba(0,0,0,0.1);
        }
        .card-header i {
            margin-right: 8px;
        }
    </style>
</h:head>

<h:body>

    <!-- HEADER  -->
    <ui:include src="/components/layout/header.xhtml" />

    <div class="container mt-5 mb-5">

        <!-- ===== TÍTULO PRINCIPAL ===== -->
        <div class="text-center mb-4">
            <h2 class="fw-bold text-success">
                <i class="bi bi-calendar-event"></i> Agenda de Instalaciones
            </h2>
            <p class="text-muted">Visualiza, filtra y gestiona las instalaciones programadas.</p>
        </div>

        <!-- ===== FILTROS ===== -->
        <h:form>
            <div class="row g-3 mb-4 justify-content-center">
                <div class="col-md-4">
                    <label class="fw-semibold">Técnico</label>
                    <h:inputText value="#{instalacionBean.filtroTecnico}"
                                 styleClass="form-control"
                                 pt:placeholder="Nombre del técnico"/>
                </div>
                <div class="col-md-3">
                    <label class="fw-semibold">Desde</label>
                    <h:inputText value="#{instalacionBean.fechaDesde}"
                                 styleClass="form-control"
                                 pt:placeholder="YYYY-MM-DD"/>
                </div>
                <div class="col-md-3">
                    <label class="fw-semibold">Hasta</label>
                    <h:inputText value="#{instalacionBean.fechaHasta}"
                                 styleClass="form-control"
                                 pt:placeholder="YYYY-MM-DD"/>
                </div>
                <div class="col-md-2 d-flex align-items-end">
                    <h:commandButton value="Filtrar"
                                     action="#{instalacionBean.aplicarFiltro}"
                                     styleClass="btn btn-outline-success rounded-pill w-100"/>
                </div>
            </div>
        </h:form>

        <!-- ===== TABLA DE INSTALACIONES ===== -->
        <div class="card shadow-sm border-0 mb-4">
            <div class="card-header bg-success text-white fw-bold">
                <i class="bi bi-table"></i> Lista de Instalaciones
            </div>
            <div class="card-body">
                <h:form>
                    <h:dataTable value="#{instalacionBean.instalaciones}" var="i"
                                 styleClass="table table-bordered table-hover text-center align-middle">

                        <h:column>
                            <f:facet name="header">Cliente</f:facet>
                            <h:outputText value="#{i.clienteNombre}"/>
                        </h:column>

                        <h:column>
                            <f:facet name="header">Técnico</f:facet>
                            <h:outputText value="#{i.tecnicoNombre}"/>
                        </h:column>

                        <h:column>
                            <f:facet name="header">Fecha</f:facet>
                            <h:outputText value="#{i.fechaInstalacion}">
                                <f:convertDateTime pattern="dd/MM/yyyy"/>
                            </h:outputText>
                        </h:column>

                        <h:column>
                            <f:facet name="header">Hora</f:facet>
                            <h:outputText value="#{i.hora}"/>
                        </h:column>

                        <h:column>
                            <f:facet name="header">Estado</f:facet>
                            <h:outputText value="#{i.estado}"
                                          styleClass="#{i.estado eq 'Completada' ? 'badge bg-success badge-status' :
                                                       (i.estado eq 'Pendiente' ? 'badge bg-warning text-dark badge-status' :
                                                       'badge bg-info text-dark badge-status')}"/>
                        </h:column>

                        <h:column>
                            <f:facet name="header">Acción</f:facet>
                            <h:commandButton value="Ver"
                                             action="#{instalacionBean.verDetalle(i)}"
                                             styleClass="btn btn-outline-primary btn-sm"
                                             onclick="const modal=new bootstrap.Modal(document.getElementById('modalDetalle'));modal.show();return false;"/>
                        </h:column>

                    </h:dataTable>
                </h:form>
            </div>
        </div>

        <!-- ===== CALENDARIO ===== -->
        <div class="mb-5">
            <h4 class="text-center text-secondary mb-3 fw-semibold">
                <i class="bi bi-calendar4-week"></i> Vista de Calendario
            </h4>
            <div id="calendar"></div>
        </div>

        <!-- ===== MODAL DETALLE ===== -->
        <div class="modal fade" id="modalDetalle" tabindex="-1" aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered">
                <div class="modal-content rounded-4 shadow">
                    <div class="modal-header bg-primary text-white">
                        <h5 class="modal-title fw-bold">
                            <i class="bi bi-info-circle"></i> Detalle de Instalación
                        </h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                    </div>
                    <div class="modal-body">
                        <h:panelGrid columns="2" cellpadding="5" styleClass="w-100">
                            <h:outputText value="Cliente:" style="font-weight:bold;"/>
                            <h:outputText value="#{instalacionBean.instalacionSeleccionada.clienteNombre}"/>

                            <h:outputText value="Técnico:" style="font-weight:bold;"/>
                            <h:outputText value="#{instalacionBean.instalacionSeleccionada.tecnicoNombre}"/>

                            <h:outputText value="Pedido:" style="font-weight:bold;"/>
                            <h:outputText value="#{instalacionBean.instalacionSeleccionada.pedidoId}"/>

                            <h:outputText value="Fecha:" style="font-weight:bold;"/>
                            <h:outputText value="#{instalacionBean.instalacionSeleccionada.fechaInstalacion}"/>

                            <h:outputText value="Hora:" style="font-weight:bold;"/>
                            <h:outputText value="#{instalacionBean.instalacionSeleccionada.hora}"/>

                            <h:outputText value="Estado:" style="font-weight:bold;"/>
                            <h:outputText value="#{instalacionBean.instalacionSeleccionada.estado}"/>
                        </h:panelGrid>
                    </div>
                    <div class="modal-footer">
                        <button class="btn btn-secondary" data-bs-dismiss="modal">
                            <i class="bi bi-x-circle"></i> Cerrar
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- ===== BOTÓN VOLVER ===== -->
        <div class="text-center">
            <button type="button"
                    class="btn btn-outline-secondary rounded-pill px-4 py-2 fw-bold"
                    onclick="window.location.href='menuPedidos.xhtml';">
                <i class="bi bi-arrow-left-circle"></i> Volver al Menú
            </button>
        </div>

    </div>

    <!-- FOOTER  -->
    <ui:include src="/components/layout/footer.xhtml" />

    <!-- ===== SCRIPT CALENDARIO ===== -->
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const calendarEl = document.getElementById('calendar');
            const calendar = new FullCalendar.Calendar(calendarEl, {
                initialView: 'dayGridMonth',
                locale: 'es',
                height: 600,
                events: [
                    { title: 'Instalación Red - Técnico A', start: '2025-11-10', color: '#0d6efd' },
                    { title: 'Mantenimiento PC - Técnico B', start: '2025-11-11', color: '#ffc107' },
                    { title: 'Cámaras - Técnico C', start: '2025-11-13', color: '#198754' }
                ]
            });
            calendar.render();
        });
    </script>

</h:body>
</html>
