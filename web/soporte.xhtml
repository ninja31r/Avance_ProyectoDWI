<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="jakarta.faces.html"
      xmlns:f="jakarta.faces.core"
      xmlns:ui="jakarta.faces.facelets"
      xmlns:pt="jakarta.faces.passthrough">

<h:head>
    <title>Centro de Soporte - Auditel Import S.A.C</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" />
    <style>
        body {
            background-color: #f7f9fc;
            font-family: "Segoe UI", sans-serif;
        }
        .card {
            border-radius: 20px;
            transition: transform .2s ease-in-out;
        }
        .card:hover {
            transform: translateY(-5px);
        }
        th {
            background-color: #007bff;
            color: white;
        }
    </style>
</h:head>

<h:body>

    <div class="container mt-5">

        <!-- Encabezado -->
        <h2 class="text-center fw-bold text-primary mb-3">
            <i class="bi bi-headset"></i> Centro de Soporte
        </h2>
        <p class="text-center text-muted mb-5">Registra un ticket de soporte o revisa tus incidencias previas.</p>

        <div class="row g-4">
            <!-- Formulario para nuevo ticket -->
            <div class="col-md-5">
                <div class="card shadow-lg border-0">
                    <div class="card-body">
                        <h4 class="fw-bold text-primary mb-3">
                            <i class="bi bi-pencil-square"></i> Nuevo Ticket
                        </h4>
                        <h:form>
                            <div class="mb-3">
                                <label class="form-label fw-semibold">Asunto</label>
                                <h:inputText value="#{soporteBean.nuevoTicket.asunto}" 
                                             styleClass="form-control" 
                                             pt:placeholder="Ejemplo: Problema con el pedido" />
                            </div>

                            <div class="mb-3">
                                <label class="form-label fw-semibold">Descripci贸n</label>
                                <h:inputTextarea value="#{soporteBean.nuevoTicket.descripcion}" 
                                                 styleClass="form-control" 
                                                 rows="4" 
                                                 pt:placeholder="Describe tu problema o duda con detalle." />
                            </div>

                            <div class="text-center mt-4">
                                <h:commandButton value="Enviar Ticket" 
                                                 action="#{soporteBean.enviarTicket}" 
                                                 styleClass="btn btn-primary rounded-pill px-4 py-2 fw-bold" />
                            </div>
                        </h:form>
                    </div>
                </div>
            </div>

            <!-- Lista de tickets existentes -->
            <div class="col-md-7">
                <div class="card shadow-lg border-0">
                    <div class="card-body">
                        <h4 class="fw-bold text-primary mb-3">
                            <i class="bi bi-list-check"></i> Mis Tickets
                        </h4>

                        <h:form>
                            <h:dataTable value="#{soporteBean.listaTickets}" var="t"
                                         styleClass="table table-striped table-hover align-middle text-center">

                                <h:column>
                                    <f:facet name="header">ID</f:facet>
                                    #{t.id}
                                </h:column>

                                <h:column>
                                    <f:facet name="header">Asunto</f:facet>
                                    #{t.asunto}
                                </h:column>

                                <h:column>
                                    <f:facet name="header">Estado</f:facet>
                                    <h:outputText value="#{t.estado}" 
                                                  styleClass="#{t.estado eq 'CERRADO' ? 'text-success fw-bold' : 'text-danger fw-bold'}" />
                                </h:column>

                                <h:column>
                                    <f:facet name="header">Fecha</f:facet>
                                    <h:outputText value="#{t.fecha}">
                                        <f:convertDateTime pattern="dd/MM/yyyy HH:mm" />
                                    </h:outputText>
                                </h:column>

                                <h:column>
                                    <f:facet name="header">Acci贸n</f:facet>
                                    <h:commandButton value="Ver" 
                                                     action="#{soporteBean.verTicket(t)}" 
                                                     styleClass="btn btn-outline-primary btn-sm" />
                                </h:column>
                            </h:dataTable>
                        </h:form>
                    </div>
                </div>
            </div>
        </div>

        <!-- Bot贸n volver -->
        <div class="text-center mt-5">
            <a href="menuPedidos.xhtml" class="btn btn-secondary rounded-pill px-4 py-2">
                <i class="bi bi-arrow-left"></i> Volver a Gesti贸n de Pedidos
            </a>
        </div>
    </div>

</h:body>
</html>
